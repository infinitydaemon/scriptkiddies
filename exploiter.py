# Scan a target and query MSF database for explotable service.
# Requires MSF 
import msfrpc
import nmap

client = msfrpc.Msfrpc({})
client.login('msf', 'msf')
scanner = nmap.PortScanner()
target_ip = '192.168.1.1'
scanner.scan(target_ip, arguments='-p-')

open_ports = []
for port in scanner[target_ip]['tcp']:
    if scanner[target_ip]['tcp'][port]['state'] == 'open':
        open_ports.append(port)

exploits = []
for port in open_ports:
    modules = client.call('module.exploits.search', f'port:{port}')
    for module in modules:
        exploits.append(module['name'])

print(f'Identified exploits for {target_ip}:')
for exploit in exploits:
    print(exploit)
